{% extends 'materi/base.html' %}
{% load static %}

{% block title %}Beranda - E-Academic{% endblock %}

{% block content %}

<section style="position: relative; height: 100vh; min-height: 600px; width: 100%; overflow: hidden; display: flex; align-items: center; justify-content: center;">

    <div id="bgCarousel" class="carousel slide carousel-fade" data-bs-ride="carousel" data-bs-interval="3000" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 0;">
        <div class="carousel-inner h-100">
            {% for p in prestasi_list %}
            <div class="carousel-item h-100 {% if forloop.first %}active{% endif %}">
                {% if p.foto_diri %}
                    <img src="{{ p.foto_diri.url }}" alt="{{ p.nama_mahasiswa }}" style="width: 100%; height: 100%; object-fit: cover; object-position: center;">
                {% else %}
                    <div style="width: 100%; height: 100%; background: #003366;"></div>
                {% endif %}
            </div>
            {% empty %}
            <div class="carousel-item active h-100">
                <div style="width: 100%; height: 100%; background: linear-gradient(135deg, #003366, #0056b3);"></div>
            </div>
            {% endfor %}
        </div>
    </div>

    <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 51, 102, 0.7); z-index: 1;"></div>

    <div class="container text-center" style="position: relative; z-index: 2;">
        <div class="row justify-content-center">
            <div class="col-lg-10">
                
                <h1 class="display-1 fw-bold text-white mb-2" style="letter-spacing: -2px; text-shadow: 0 5px 15px rgba(0,0,0,0.3);">
                    E-ACADEMIC
                </h1>

                <h2 class="text-warning fw-bold mb-4" style="font-size: 2rem;">
                    Wadah Prestasi & Inovasi Mahasiswa
                </h2>

                <p class="lead text-white-50 mb-5 mx-auto" style="max-width: 700px; font-size: 1.1rem; line-height: 1.8;">
                    Portal resmi integrasi data akademik. Temukan materi kuliah, arsip karya inovasi, info lomba terbaru, dan apresiasi bagi mahasiswa berprestasi di sini.
                </p>

                <div class="d-flex justify-content-center gap-3">
                    <a href="{% url 'list_materi' %}" class="btn btn-primary btn-lg rounded-pill px-5 py-3 fw-bold shadow-lg hover-scale">
                        <i class="fa fa-search me-2"></i> Cari Materi
                    </a>
                    <a href="{% url 'input_karya' %}" class="btn btn-outline-light btn-lg rounded-pill px-5 py-3 fw-bold hover-bg-white">
                        <i class="fa fa-upload me-2"></i> Upload Karya
                    </a>
                </div>

            </div>
        </div>
    </div>
    
    <div class="carousel-indicators" style="z-index: 3; bottom: 30px;">
        {% for p in prestasi_list %}
        <button type="button" data-bs-target="#bgCarousel" data-bs-slide-to="{{ forloop.counter0 }}" class="{% if forloop.first %}active{% endif %} mx-1" style="width: 30px; height: 3px;"></button>
        {% endfor %}
    </div>

</section>


<section class="py-5 bg-white">
    <div class="container" style="margin-top: -60px; position: relative; z-index: 10;">
        <div class="row g-4">
            
            <div class="col-lg-6">
                <div class="bg-white p-4 rounded-4 shadow hover-up h-100 border-top border-5 border-primary">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h4 class="fw-bold text-dark mb-0"><i class="fa fa-bullhorn text-primary me-2"></i> Info Lomba</h4>
                        <a href="#" class="text-decoration-none small fw-bold">Lihat Semua</a>
                    </div>

                    {% for lomba in info_lomba_list %}
                    <div class="d-flex align-items-center mb-3 p-3 rounded-3 bg-light transition-all hover-bg-gray">
                        <div class="text-center px-3 border-end border-2 border-primary">
                            <h4 class="fw-bold m-0 text-dark">{{ lomba.tanggal_pelaksanaan|date:"d" }}</h4>
                            <small class="text-uppercase fw-bold text-muted" style="font-size: 11px;">{{ lomba.tanggal_pelaksanaan|date:"M" }}</small>
                        </div>
                        <div class="ms-3">
                            <h6 class="mb-1 fw-bold text-dark">
                                <a href="{% url 'detail_lomba' lomba.id %}" class="text-dark text-decoration-none stretched-link">{{ lomba.judul }}</a>
                            </h6>
                            <small class="text-muted"><i class="fa fa-building-o me-1"></i> {{ lomba.penyelenggara }}</small>
                        </div>
                    </div>
                    {% empty %}
                    <div class="alert alert-light text-center">Belum ada info lomba aktif.</div>
                    {% endfor %}
                </div>
            </div>

            <div class="col-lg-6">
                <div class="bg-white p-4 rounded-4 shadow hover-up h-100 border-top border-5 border-warning">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h4 class="fw-bold text-dark mb-0"><i class="fa fa-calendar-check-o text-warning me-2"></i> Agenda</h4>
                        <a href="{% url 'kalender' %}" class="text-decoration-none small fw-bold">Buka Kalender</a>
                    </div>
                    
                    <ul class="list-unstyled">
                        <li class="d-flex justify-content-between align-items-center py-3 border-bottom border-light">
                            <span class="fw-medium"><i class="fa fa-circle text-success me-2 small"></i> Pembayaran UKT</span>
                            <span class="badge bg-success-subtle text-success border border-success px-3 rounded-pill">1 - 20 Jan</span>
                        </li>
                        <li class="d-flex justify-content-between align-items-center py-3 border-bottom border-light">
                            <span class="fw-medium"><i class="fa fa-circle text-primary me-2 small"></i> Pengisian KRS</span>
                            <span class="badge bg-primary-subtle text-primary border border-primary px-3 rounded-pill">25 - 30 Jan</span>
                        </li>
                        <li class="d-flex justify-content-between align-items-center py-3">
                            <span class="fw-medium"><i class="fa fa-circle text-warning me-2 small"></i> Kuliah Perdana</span>
                            <span class="badge bg-warning-subtle text-warning-emphasis border border-warning px-3 rounded-pill">10 Feb</span>
                        </li>
                    </ul>
                </div>
            </div>

        </div>
    </div>
</section>


<section class="py-5" style="background-color: #f4f6f9; overflow: hidden;">
    <div class="container pt-4">
        
        <div class="text-center mb-5 reveal-on-scroll">
            <span class="text-primary fw-bold text-uppercase letter-spacing-2">Hall of Fame</span>
            <h2 class="fw-bold text-dark display-6">Mahasiswa Berprestasi</h2>
            <div class="mx-auto mt-2" style="width: 60px; height: 3px; background: #ffc107;"></div>
        </div>

        <div class="row g-3"> 
            {% for p in prestasi_list %}
            
            <div class="col-lg-3 col-md-6 reveal-on-scroll" style="transition-delay: {{ forloop.counter }}00ms;">
                
                <div class="card h-100 border-0 shadow-sm rounded-4 overflow-hidden premium-card">
                    
                    <div class="img-frame position-relative">
                        {% if p.foto_diri %}
                            <img src="{{ p.foto_diri.url }}" class="card-img-top" alt="{{ p.nama_mahasiswa }}">
                        {% else %}
                            <div class="d-flex align-items-center justify-content-center bg-light h-100">
                                <i class="fa fa-user fa-3x text-muted"></i>
                            </div>
                        {% endif %}
                        
                        <div class="position-absolute top-0 end-0 m-2">
                            <span class="badge bg-warning text-dark fw-bold shadow-sm px-2 py-1 rounded-pill d-flex align-items-center gap-1" style="font-size: 11px;">
                                <i class="fa fa-trophy"></i> {{ p.juara }}
                            </span>
                        </div>
                    </div>

                    <div class="card-body text-center p-3 bg-white d-flex flex-column">
                        
                        <h6 class="fw-bold text-dark mb-2 text-truncate" style="font-size: 1.1rem;">
                            <a href="{% url 'detail_prestasi' p.id %}" class="text-dark text-decoration-none stretched-link">
                                {{ p.nama_mahasiswa }}
                            </a>
                        </h6>

                        <div class="d-flex align-items-center justify-content-center w-100 mb-2" style="min-height: 40px;">
                            <p class="text-primary fw-bold text-uppercase mb-0" style="font-size: 10px; line-height: 1.3; letter-spacing: 0.5px;">
                                {{ p.get_prodi_display }}
                            </p>
                        </div>

                        <hr class="opacity-10 my-1 w-50 mx-auto">

                        <div class="mt-2 flex-grow-1"> 
                            <p class="text-muted small mb-1 fst-italic" style="font-size: 11px;">Kompetisi:</p>
                            <p class="text-dark fw-medium small text-truncate-2 mb-0" style="line-height: 1.3;">
                                {{ p.nama_lomba }}
                            </p>
                        </div>

                        <div class="mt-3">
                            <span class="badge bg-light text-secondary border px-2 py-1" style="font-size: 10px;">
                                {{ p.tingkat }}
                            </span>
                        </div>
                    </div>
                    
                    <div class="card-footer p-0 border-0 bg-primary" style="height: 4px;"></div>
                </div>
            </div>
            {% endfor %}
        </div>
        
        <div class="text-center mt-5 reveal-on-scroll">
            <a href="{% url 'list_prestasi' %}" class="btn btn-outline-primary rounded-pill px-5 py-2 fw-bold btn-sm">Lihat Semua Prestasi</a>
        </div>
    </div>
</section>


<style>
    /* 1. ANIMASI SCROLL (Cepat & Smooth) */
    .reveal-on-scroll {
        opacity: 0;
        transform: translateY(40px); 
        transition: all 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    }
    .reveal-on-scroll.active {
        opacity: 1;
        transform: translateY(0);
    }

    /* 2. EFEK KARTU */
    .premium-card {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        background: #fff;
    }
    .premium-card:hover {
        transform: translateY(-5px); /* Naik sedikit */
        box-shadow: 0 15px 30px rgba(0,0,0,0.1) !important;
    }

    /* 3. GAMBAR & FRAME (Lebih Pendek) */
    .img-frame { 
        height: 220px; 
        overflow: hidden; 
        position: relative; 
    }
    .card-img-top {
        width: 100%; height: 100%; object-fit: cover; object-position: top;
        transition: transform 0.5s ease;
    }
    .premium-card:hover .card-img-top { transform: scale(1.08); }

    /* 4. UTILITIES */
    .text-truncate-2 {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
        height: 36px;
    }
    .letter-spacing-2 { letter-spacing: 2px; }
    .hover-scale:hover { transform: scale(1.05); }
    .hover-up:hover { transform: translateY(-10px); }
    .hover-bg-white:hover { background-color: white !important; color: #003366 !important; }
    .hover-bg-gray:hover { background-color: #e9ecef !important; }

    /* Overlay Slider */
    .carousel-item::after {
        content: ""; display: block; position: absolute;
        top: 0; bottom: 0; left: 0; right: 0;
        background: linear-gradient(to bottom, rgba(0,0,0,0.3) 0%, rgba(0,0,0,0.7) 100%);
    }
</style>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        const observerOptions = {
            root: null,
            rootMargin: '0px',
            threshold: 0.15 
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('active'); // Muncul
                } else {
                    entry.target.classList.remove('active'); // Reset (Hilang) agar bisa muncul lagi
                }
            });
        }, observerOptions);

        const hiddenElements = document.querySelectorAll('.reveal-on-scroll');
        hiddenElements.forEach((el) => observer.observe(el));
    });
</script>

{% endblock %}